<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nonogram</title>
    <style>
      .cell {
            width: 50px;
            height: 50px;
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }
        .grid {
            display: grid;
            gap: 2px;
            margin: 10px 0;
        }
        .grid-3x3 {
            grid-template-columns: repeat(4, 50px);
            grid-template-rows: repeat(4, 50px);
        }
        .filled {
            background-color: rgb(184, 35, 119);
        }
        .hint {
            font-weight: bold;
        }
        .info {
            font-size: 20px;
            margin: 10px 0;
        }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script>
        // Model
const app = document.getElementById("app");
let lives = 3;
let result = "";
let randomNonogram;
let coloredCells = [];
let rightClickedCells = [];
const nonograms3x3 = [
    { cells: [5, 6, 9, 10, 11, 14], rows: ["2", "3", "1"], cols: ["2", "3", "1"] },
    { cells: [6, 7, 9, 10, 13, 15], rows: ["2", "2", "1, 1"], cols: ["2", "2", "1, 1"] },
    { cells: [5, 7, 10, 13, 15], rows: ["1, 1", "1", "1, 1"], cols: ["1, 1", "1", "1, 1"] }
];

// Controller
function startGame() {
    lives = 3;
    result = "";
    coloredCells = [];
    rightClickedCells = [];
    randomNonogram = nonograms3x3[Math.floor(Math.random() * nonograms3x3.length)];
    renderBoard();
}

function handleCellClick(id) {
    const cellIndex = Number(id);
    if (coloredCells.includes(cellIndex)) {
        coloredCells = coloredCells.filter(index => index !== cellIndex);
    } else {
        coloredCells.push(cellIndex);
    }
    checkSolution();
    renderBoard();
}

function handleRightClick(e, id) {
    e.preventDefault();
    const cellIndex = Number(id);
    if (rightClickedCells.includes(cellIndex)) {
        rightClickedCells = rightClickedCells.filter(index => index !== cellIndex);
    } else {
        rightClickedCells.push(cellIndex);
    }
    renderBoard();
}

function checkSolution() {
    if (coloredCells.some(cell => !randomNonogram.cells.includes(cell))) {
        lives--;
    }
    if (lives <= 0) {
        result = "Aww, you lost!";
    }
    if (arraysEqual(coloredCells.sort(), randomNonogram.cells.sort())) {
        result = "Congrats! You got it!";
    }
}

function arraysEqual(arr1, arr2) {
    return JSON.stringify(arr1) === JSON.stringify(arr2);
}

// View
function renderBoard() {
    let gridHtml = "";
    for (let i = 0; i < 16; i++) {
        let cellClass = "cell";
        if (i > 3 && i % 4 !== 0) {
            cellClass += coloredCells.includes(i) ? " filled" : "";
        }
        gridHtml += `<div id="${i}" class="${cellClass}" 
                     onclick="handleCellClick(this.id)" 
                     oncontextmenu="handleRightClick(event, this.id)">
                     ${getCellContent(i)}
                     </div>`;
    }
    app.innerHTML = `
        <div class="grid grid-3x3">${gridHtml}</div>
        <div class="info">Lives left: ${lives}</div>
        <div class="info">${result}</div>
        <button onclick="startGame()">Restart</button>
    `;
}

function getCellContent(i) {
    if (i <= 3 && i > 0) return randomNonogram.cols[i - 1];
    if (i % 4 === 0 && i !== 0) return randomNonogram.rows[i / 4 - 1];
    if (rightClickedCells.includes(i)) return "x";
    return "";
}

startGame();


    </script>
  </body>
</html>
